<!-- Node/Edge Editor
     1) select LABEL     
     2) edit JSON (props)
     3) if created, call API of TP Sync (about create) => id
-->
<div id="graphCard" class="col flex-1 p20">
  <div class="mb20 row row-c row-space">
    <h4>{{ element.group | uppercase }} <strong>Editor</strong></h4>
  </div>
  <ul class="property-list col flex-1">
    <li class="row row-m row-space">
      <span>ID</span>
      <mat-form-field class="col">
        <input matInput [value]="element.data.id" readonly="true">
      </mat-form-field>
    </li>
    <li *ngIf="element.group == 'edges'" class="row row-m row-space">
        <span>source-nodeID</span>
        <mat-form-field class="col">
          <input matInput [value]="element.data.source" readonly="true">
        </mat-form-field>
    </li>
    <li *ngIf="element.group == 'edges'" class="row row-m row-space">
        <span>target-node ID</span>
        <mat-form-field class="col">
          <input matInput [value]="element.data.target" readonly="true">
        </mat-form-field>
    </li>
    <li class="row row-m row-space">
      <span>Label</span>
      <mat-form-field>
        <!-- case : old element -->
        <input matInput *ngIf="!created" [value]="element.data.label" type="text" readonly="true">
        <!-- case : new element -->
        <input matInput *ngIf="created" placeholder="label name" [formControl]="editLabelCtl" 
            [matAutocomplete]="autoSelector">
        <mat-autocomplete #autoSelector="matAutocomplete">
          <mat-option *ngFor="let label of labels" [value]="label.name">
            {{label.name}}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </li>
    <li class="col flex-1">
      <span>Properties</span>
      <!-- <div class="json-box col flex-1">
        <pre [innerHtml]="element.data.props | prettyjson:3"></pre>
      </div> -->
      <ngx-datatable #tblProperties class="material"
        [headerHeight]="50" [limit]="5" [columnMode]="'force'"
        [footerHeight]="50" [rowHeight]="'auto'" [rows]="properties">
        <ngx-datatable-column name="key" [width]="120">
          <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row">
            <span title="Double click to edit"
              (dblclick)="editing[rowIndex + '-key'] = (row.state == 'new') ? true : false"
              *ngIf="!editing[rowIndex + '-key']">
              {{value}}
            </span>
            <input autofocus (blur)="updateValue($event, 'key', rowIndex)"
              *ngIf="editing[rowIndex+ '-key']" type="text" [value]="value"
            />
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="value" [width]="240">
          <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row" let-value="value">
             <span title="Double click to edit"
              (dblclick)="editing[rowIndex + '-value'] = true"
              *ngIf="!editing[rowIndex + '-value']">
              {{value}}
            </span>
            <input autofocus (blur)="updateValue($event, 'value', rowIndex)"
              *ngIf="editing[rowIndex+ '-value']" type="text" [value]="value"
            />
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="type" [width]="80">
          <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-row="row" let-value="value">
            <span title="Double click to edit"
              (dblclick)="editing[rowIndex + '-type'] = (row.state == 'new') ? true : false"
              *ngIf="!editing[rowIndex + '-type']">
              {{value}}
            </span>
              <select
                *ngIf="editing[rowIndex + '-type']"
                (blur)="editing[rowIndex + '-type'] = false"
                (change)="updateValue($event, 'type', rowIndex)"
                [value]="value">
                <option value="STRING">string</option>
                <option value="NUMBER">number</option>
                <option value="ARRAY">array</option>
                <option value="OBJECT">object</option>
                <option value="BOOLEAN">boolean</option>
              </select>
            </ng-template>
          </ngx-datatable-column>        
      </ngx-datatable>        
    </li>
  </ul>

  <button mat-raised-button color="accent" (click)="addNewProperty()">add Property</button>
  <button mat-raised-button color="primary" [disabled]="!changed" (click)="close()">Update</button>
</div>
